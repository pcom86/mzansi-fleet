<div class="route-management-container">
  <mat-card class="form-card">
    <mat-card-header>
      <mat-card-title>{{ editMode ? 'Edit Route' : 'Create New Route' }}</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="routeForm" (ngSubmit)="onSubmit()">
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Taxi Association</mat-label>
            <mat-select formControlName="tenantId">
              <mat-option *ngFor="let tenant of tenants" [value]="tenant.id">
                {{ tenant.name }} ({{ tenant.code }})
              </mat-option>
            </mat-select>
            <mat-hint>Select the association for this route</mat-hint>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Route Name</mat-label>
            <input matInput formControlName="name" placeholder="e.g., Johannesburg to Pretoria">
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Route Code</mat-label>
            <input matInput formControlName="code" readonly>
            <mat-hint>Auto-generated</mat-hint>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Origin</mat-label>
            <input matInput formControlName="origin" placeholder="Starting point">
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Destination</mat-label>
            <input matInput formControlName="destination" placeholder="Ending point">
          </mat-form-field>
        </div>

        <div class="stops-section">
          <div class="stops-header">
            <h4>Stops Along Route</h4>
            <button mat-mini-fab color="primary" type="button" (click)="addStop()">
              <mat-icon>add</mat-icon>
            </button>
          </div>
          <div formArrayName="stops" class="stops-list">
            <div *ngFor="let stop of stops.controls; let i = index" class="stop-item">
              <mat-form-field appearance="outline" class="stop-field">
                <mat-label>Stop {{ i + 1 }}</mat-label>
                <input matInput [formControlName]="i" placeholder="Stop location">
              </mat-form-field>
              <button mat-icon-button color="warn" type="button" (click)="removeStop(i)">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Distance (km)</mat-label>
            <input matInput type="number" formControlName="distance" placeholder="0">
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Duration (minutes)</mat-label>
            <input matInput type="number" formControlName="estimatedDuration" placeholder="0">
          </mat-form-field>
        </div>

        <div class="destination-fares-section" *ngIf="getAllDestinations().length > 0">
          <h4>Fare Amounts per Destination</h4>
          <div class="fares-grid">
            <mat-form-field appearance="outline" class="fare-field" *ngFor="let dest of getAllDestinations()" [formGroup]="destinationFaresFormGroup">
              <mat-label>Fare to {{ dest }} (R)</mat-label>
              <input matInput type="number" [formControlName]="dest" placeholder="0.00">
            </mat-form-field>
          </div>
        </div>

        <div class="form-actions">
          <button mat-raised-button type="button" (click)="resetForm()" *ngIf="editMode">
            Cancel
          </button>
          <button mat-raised-button color="primary" type="submit" [disabled]="loading">
            {{ editMode ? 'Update Route' : 'Create Route' }}
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <mat-card class="table-card">
    <mat-card-header>
      <mat-card-title>Existing Routes</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <table mat-table [dataSource]="routes" class="routes-table">
        <ng-container matColumnDef="code">
          <th mat-header-cell *matHeaderCellDef>Code</th>
          <td mat-cell *matCellDef="let route">{{ route.code }}</td>
        </ng-container>

        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Name</th>
          <td mat-cell *matCellDef="let route">{{ route.name }}</td>
        </ng-container>

        <ng-container matColumnDef="origin">
          <th mat-header-cell *matHeaderCellDef>Origin</th>
          <td mat-cell *matCellDef="let route">{{ route.origin }}</td>
        </ng-container>

        <ng-container matColumnDef="destination">
          <th mat-header-cell *matHeaderCellDef>Destination</th>
          <td mat-cell *matCellDef="let route">{{ route.destination }}</td>
        </ng-container>

        <ng-container matColumnDef="distance">
          <th mat-header-cell *matHeaderCellDef>Distance</th>
          <td mat-cell *matCellDef="let route">{{ route.distance }} km</td>
        </ng-container>

        <ng-container matColumnDef="fare">
          <th mat-header-cell *matHeaderCellDef>Fare</th>
          <td mat-cell *matCellDef="let route">R {{ route.fareAmount }}</td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let route">
            <span [class.status-active]="route.status === 'Active'" 
                  [class.status-inactive]="route.status !== 'Active'">
              {{ route.status }}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let route">
            <button mat-icon-button color="primary" (click)="editRoute(route)">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="deleteRoute(route.id)">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </mat-card-content>
  </mat-card>
</div>
